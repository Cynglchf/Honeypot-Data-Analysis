# Malware Analysis

The files analyzed in this report were originally collected from a honeypot environment where they had been uploaded during malicious activity. The collected files are:

| Filename | Virustotal |
| --- | --- |
| clean.sh | [Virustotal](https://www.virustotal.com/gui/file/d46555af1173d22f07c37ef9c1e0e74fd68db022f2b6fb3ab5388d2c5bc6a98e/) |
| redtail.arm7 | [Virustotal](https://www.virustotal.com/gui/file/be8f32a15a3077ab8f5d25236d6e7b491cd216028f77d27bed5df333ff7c56c0) |
| redtail.arm8 | [Virustotal](https://www.virustotal.com/gui/file/54b2d5f2a6f711e3b9d6d23466b4d841137b61518d49d432d265af931a797b0a) |
| redtail.i686 | [Virustotal](https://www.virustotal.com/gui/file/9a29013698f27f568f1e6e07c2f121b133bb4418b5cd52c3d4dc3a668a1b359e) |
| redtail.x86_64 | [Virustotal](https://www.virustotal.com/gui/file/f5ed87690ff6ab07868a23054d73b173f620b9d0abbfe4e16a0e0111ae0d73af) |

Before moving on to the detailed analysis of the **Redtail** malware I will briefly introduce the **clean.sh** shell script that was found alongside the collected samples. After this brief introduction I will begin the in‑depth malware analysis of the **redtail.arm7** malware sample.

# Shell Script clean.sh

[Virustotal](https://www.virustotal.com/) provides us the following information about the **clean.sh** file:

```plaintext
The script performs the following actions:

1. Disables and stops a service named 'c3pool_miner'.

2. Removes any crontab entries containing specific commands or patterns related to downloading files, executing commands,
or establishing network connections. This is done by iterating through user and system crontabs, as well as cron directories,
and filtering out any matching entries.

3. Cleans up temporary directories by removing all files within '/tmp', '/var/tmp', and '/dev/shm'.
```

  

Analysis of the malicious file revealed that **clean.sh** is a shell script designed to remove competing malware particularly other cryptominers before deploying the attacker's own payload. For this reason I briefly examined this script before moving on to the analysis of **Redtail** as it is executed prior to deploying Redtail onto the target system and helps us understand the overall malware chain.

# Malware Analysis of Redtail

Next I will analyse the **redtail.arm7** malware sample, with all information about the malware's behavior obtained and analyzed entirely from [Malware Analysis Report](https://www.joesandbox.com/analysis/1812440/0/html) by [JoeSandBox](https://www.joesandbox.com)

**Redtail** is a malicious [XMRig](https://github.com/xmrig/xmrig)‑based cryptojacking-malware that exploits the victim's system resources to mine cryptocurrency for the attacker. It begins its operation by collecting basic information about the infected system. It reads files such as /proc/cpuinfo and /proc/meminfo, which indicates that the malware wants to identify the device's hardware capabilities. This matches with the behavior seen earlier in the Top 10 Most Used Commands list in 02_attacker_behavior_analysis which also included the commands such as cat /proc/cpuinfo.

The malware also tries to hide itself by packing its executable with UPX to obfuscate its data and make analysis more difficult.

# Persistence

The malware implements multiple persistence mechanisms that ensure it starts automatically whenever the system is rebooted. Its persistence relies primarily on cron scheduling and manipulation of firewall rules to maintain access to the compromised device.

# Cron-based Persistence

The malware establishes cron-based persistence through two main steps:

First the malware deletes all existing cron tasks on the system using the command:

```Plaintext
sh -c "crontab -r >/dev/null 2>&1
```

After clearing all existing cron tasks the malware adds its own cron entry that runs at every system startup:

```Plaintext
echo "@reboot /tmp/arm7.elf" | crontab -
```

# Firewall-Based Persistence

As an additional persistence method the malware modifies iptables firewall rules.

First the malware removes all firewall rules with the command:

```Plaintext
sh -c "iptables -F >/dev/null 2>&1;
```

Next the malware opens port 34015 which the attacker can use to access the system:

```Plaintext
iptables -I INPUT -p tcp --dport 34015 -j ACCEPT
```
As a final step the malware adds a rule to permit SSH connections from the attacker-controlled IP address:

```Plaintext
iptables -C INPUT -p tcp --dport 22 -s <IP-ADRESS> -j ACCEPT 2>/dev/null || iptables -A INPUT -p tcp --dport 22 -s <IP-ADRESS> -j ACCEPT
```

# Conclusions

Analysis of the malicious files collected from the honeypot revealed that the attack consists of a two‑stage process. The attack chain begins with the execution of the clean.sh shell script which removes competing cryptojacking malware and prepares the system for the attacker's payload. After this the **Redtail** cryptojacking malware is executed, exploiting the infected device's computing resources for cryptocurrency mining, establishing persistence through cron jobs, firewall rule manipulation and obfuscating its code to evade detection.
